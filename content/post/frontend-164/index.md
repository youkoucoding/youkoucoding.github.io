---
title: '毎日のフロントエンド  164'
date: 2022-02-27T11:57:20+09:00
description: frontend 每日一练
categories:
  - HTML
  - CSS
  - JavaScript
---

## HTML

### 前端路由指的是什么

- spa（单页）应用根据 url 变化动态切换组件展示
- `hash`和`histrory`模式
  - `hash`
    - Web 服务并不会解析 hash，也就是说#后的内容 Web 服务都会自动忽略，但是 JavaScript 是可以通过 window.location.hash 读取到的，读取到路径加以解析之后就可以响应不同路径的逻辑处理。`hashchange` 事件(监听 hash 变化触发的事件)，当用 `window.location` 处理哈希的改变时不会重新渲染页面，而是当作新页面加到历史记录中，这样我们跳转页面就可以在 hashchange 事件中注册 ajax 从而改变页面内容。
  - `history`
    - 将 a 标签中的默认跳转替换为 ajax 请求，然后通过 `history.pushState` 来改变路由（ajax 可以实现页面不刷新的） 浏览器的前进与后退，会触发 `window.onpopstate` 事件，通过绑定 `popstate` 事件，就可以根据当前 URL 地址中的查询内容让对应的菜单执行 Ajax 载入，实现 Ajax 的前进与后退效果。页面首次载入的时候，如果没有查询地址、或查询地址不匹配，则使用第一个菜单的 Ajax 地址的查询内容，并使用 `history.replaceState` 更改当前的浏览器历史，然后触发 Ajax 操作。

## CSS

### `resetting`和`normalizing`

- 两者都是统一不同浏览器默认样式
  - `resetting` 是减法
  - `normalizing` 是加法 ✅

## Tips

### `DOM`

- 标签是 HTML 的基本单位，比如 p、div、input；
- 节点是 DOM 树的基本单位，有多种类型，比如注释节点、文本节点；
- 元素是节点中的一种，与 HTML 标签相对应，比如 p 标签会对应 p 元素
  - `<p>亚当斯密</p>` **`p` 是标签， 生成 DOM 树的时候会产生两个节点，一个是元素节点 p，另一个是字符串为“亚当斯密”的文本节点。**

#### DOM 操作耗时

- 线程切换

  - 浏览器包含渲染引擎（也称浏览器内核）和 JavaScript 引擎，它们都是单线程运行。单线程的优势是开发方便，避免多线程下的死锁、竞争等问题，劣势是失去了并发能力。
  - 两个引擎具有互斥性，也就是说在某个时刻只有一个引擎在运行，另一个引擎会被阻塞。操作系统在进行线程切换的时候需要保存上一个线程执行时的状态信息并读取下一个线程的状态信息，俗称上下文切换。而这个操作相对而言是比较耗时的。
  - 每次 DOM 操作就会引发线程的上下文切换——从 JavaScript 引擎切换到渲染引擎执行对应操作，然后再切换回 JavaScript 引擎继续执行，这就带来了性能损耗。单次切换消耗的时间是非常少的，但是如果频繁地大量切换，那么就会产生性能问题。

- 重新渲染
  - 元素及样式变化引起的再次渲染，在渲染过程中最耗时的两个步骤为重排（`Reflow`）与重绘（`Repaint`）
  - 浏览器在渲染页面时会将 HTML 和 CSS 分别解析成 DOM 树和 CSSOM 树，然后合并进行排布，再绘制成我们可见的页面。如果在操作 DOM 时涉及到元素、样式的修改，就会引起渲染引擎重新计算样式生成 CSSOM 树，同时还有可能触发对元素的重新排布（简称“重排”）和重新绘制（简称“重绘”）
  - 可能会影响到其他元素排布的操作就会引起重排，继而引发重绘，比如：
    - 修改元素边距、大小
    - 添加、删除元素
    - 改变窗口大小
  - 与之相反的操作则只会引起重绘，比如： - 设置背景图片 - 修改字体颜色 - 改变 visibility 属性值
    > 重排渲染耗时明显高于重绘，重排会导致重绘

#### 如何高效操作 DOM

1. 在循环外操作元素
2. 批量操作元素
3. 缓存元素集合

---

- 尽量不要使用复杂的匹配规则和复杂的样式，从而减少渲染引擎计算样式规则生成 CSSOM 树的时间；
- 尽量减少重排和重绘影响的区域；
- 使用 CSS3 特性来实现动画效果。

## Reference

[haizlin/fe-interview](https://github.com/haizlin/fe-interview/blob/master/category/history.md)

[CSS Triggers](https://csstriggers.com/)
