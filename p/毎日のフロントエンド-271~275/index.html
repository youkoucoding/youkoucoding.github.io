<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="frontend 每日一练"><title>毎日のフロントエンド 271~275</title><link rel=canonical href=https://youkoucoding.github.io/p/%E6%AF%8E%E6%97%A5%E3%81%AE%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89-271~275/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="毎日のフロントエンド 271~275"><meta property="og:description" content="frontend 每日一练"><meta property="og:url" content="https://youkoucoding.github.io/p/%E6%AF%8E%E6%97%A5%E3%81%AE%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89-271~275/"><meta property="og:site_name" content="技術の手帳"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:published_time" content="2022-05-19T21:06:57+09:00"><meta property="article:modified_time" content="2022-05-19T21:06:57+09:00"><meta name=twitter:title content="毎日のフロントエンド 271~275"><meta name=twitter:description content="frontend 每日一练"><link rel="shortcut icon" href=/img/site-icon.png></head><body class="article-page has-toc"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=https://youkoucoding.github.io/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>返回</span></a></div><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/tips/>Tips</a></header><h2 class=article-title><a href=/p/%E6%AF%8E%E6%97%A5%E3%81%AE%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89-271~275/>毎日のフロントエンド 271~275</a></h2><h3 class=article-subtitle>frontend 每日一练</h3><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>May 19, 2022</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>阅读时长: 2 分钟</time></div></footer></div></header><section class=article-content><h2 id=tips>Tips</h2><h3 id=移动端禁止用户手动缩放页面>移动端禁止用户手动缩放页面</h3><ul><li><code>&lt;meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"></code></li></ul><h3 id=arrayprototypesort><code>Array.prototype.sort()</code></h3><ul><li><code>sort()</code> 方法用原地算法对数组的元素进行排序，并返回数组。<ul><li>默认排序顺序是在将元素转换为字符串，然后比较它们的 UTF-16 代码单元值序列时构建的</li></ul></li></ul><h3 id=js-错误堆栈处理>JS 错误堆栈处理</h3><blockquote><p>JavaScript 中主要是通过 <code>Error</code> 对象和 <code>Stack Traces</code> 提供有价值的错误堆栈，帮助开发者调试。在服务端开发中，开发者可以将有价值错误信息打印到服务器日志中，而对于客户端而言就很难重现用户环境下的报错</p></blockquote><h4 id=stack><strong>Stack</strong></h4><ul><li>js 中函数调用栈的概念，符合栈的基本特性『当调用时，压入栈顶。当它执行完毕时，被弹出栈』</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>c</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>bar</span> <span class=o>=</span> <span class=nx>baz</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>stack</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>b</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>c</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>a</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>b</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>a</span><span class=p>();</span>
</span></span></code></pre></div><ul><li>上述代码中会在执行到 c 函数的时候跑错，调用栈为 <code>a -> b -> c</code>, 错误堆栈可以帮助定位到报错的位置</li></ul><h4 id=error-对象><strong>Error 对象</strong></h4><ul><li>Error 对象，主要有两个重要属性 message 和 name 分别表示<em>错误信息</em>和<em>错误名称</em>, 除了这两个属性还有一个未被标准化的 stack 属性<ul><li><code>e.stack</code>，这个属性包含了错误信息、错误名称以及错误栈信息 <a class=link href=https://sentry.io/features/stacktrace/ target=_blank rel=noopener>Stack Trace</a></li></ul></li></ul><h4 id=如何使用堆栈追踪>如何使用堆栈追踪</h4><ul><li>以 NodeJS 环境为例，讲解了 Error.captureStackTrace，将 stack 信息作为属性存储在一个对象当中，同时可以过滤掉一些无用的堆栈信息。这样可以隐藏掉用户不需要了解的内部细节。</li><li>作者也以 Chai 为例，内部使用该方法对代码的调用者屏蔽了不相关的实现细节。通过以 Assertion 对象为例，讲述了具体的内部实现，简单来说通过一个 addChainableMethod 链式调用工具方法，在运行一个 Assertion 时，将它设为标记，其后面的堆栈会被移除；<ul><li>如果 assertion 失败移除起后面所有内部堆栈；</li><li>如果有内嵌 assertion，将当前 assertion 的方法放到 ssfi 中作为标记，移除后面堆栈帧；</li></ul></li></ul><h4 id=抛-error-对象的正确方法>抛 Error 对象的正确方法</h4><ul><li>正确的做法应该是使用 throw new Error(“error message here”)，这里还引用了 <a class=link href=https://www.joyent.com/node-js/production/design/errors target=_blank rel=noopener>Node.js 中推荐的异常处理方式:</a><ul><li>区分操作异常和程序员的失误。操作异常指可预测的不可避免的异常，如无法连接服务器</li><li>操作异常应该被处理。程序员的失误不需要处理，如果处理了反而会影响错误排查</li><li>操作异常有两种处理方式：同步 (<code>try……catch</code>) 和异步（callback, event - emitter）两种处理方式，<em>但只能选择其中一种</em></li><li>函数定义时应该用文档写清楚参数类型，及可能会发生的合理的失败。以及错误是同步还是异步传给调用者的</li><li>缺少参数或参数无效是程序员的错误，一旦发生就应该 throw。 传递错误时，使用标准的 Error 对象，并附件尽可能多的错误信息，可以使用标准的属性名</li></ul></li></ul><h4 id=异步promise环境下错误处理方式>异步（Promise）环境下错误处理方式</h4><ul><li>在 Promise 内部使用 reject 方法来处理错误，而不要直接调用 throw Error，这样你不会捕捉到任何的报错信息</li><li>reject 如果使用 Error 对象，会导致捕获不到错误的情况</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>thirdFunction</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>reject</span><span class=p>(</span><span class=s1>&#39;我可以被捕获&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// throw Error(&#39;永远无法被捕获&#39;)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>thirdFunction</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=k>catch</span><span class=p>((</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;捕获异常&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span> <span class=c1>// 捕获异常 我可以被捕获
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>});</span>
</span></span></code></pre></div><ul><li>在 macrotask 队列中，reject 行为是可以被 catch 到的，而此时 throw Error 就无法捕获异常，第二次把 reject(&lsquo;可以被捕获&rsquo;) 注释起来，取消 throw Error(&lsquo;永远无法被捕获&rsquo;) 的注释，会发现异常无法 catch。<ul><li>因为 setTimeout 中 throw Error 无论如何都无法捕获到，而 reject 是 Promise 提供的关键字，自己当然可以 catch</li></ul></li></ul><h4 id=监控客户端-error-报错>监控客户端 Error 报错</h4><ul><li><code>try...catch</code> 可以拿到出错的信息，堆栈，出错的文件、行号、列号等，但<em>无法捕捉到语法错误</em>，<em>没法去捕捉全局的异常事件</em> 在一些古老的浏览器下 try&mldr;catch 对 js 的性能也有一定的影响。</li><li>另一个捕捉异常的方法，即 <code>window.onerror</code> 可以捕捉语法错误和运行时错误，并且拿到出错的信息，堆栈，出错的文件、行号、列号等<ul><li>由于是全局监测，就会统计到浏览器插件中的 js 异常</li><li>给应用内所需的 <code>&lt;script></code> 标签添加 <code>crossorigin</code> 属性；</li><li>在 js 所在的 cdn 服务器上添加 <code>Access-Control-Allow-Origin: *</code> HTTP 头；</li></ul></li></ul><h2 id=reference>Reference</h2><ul><li><p><a class=link href=https://github.com/haizlin/fe-interview/blob/master/category/history.md target=_blank rel=noopener>fe-interview/history.md</a></p></li><li><p><a class=link href=https://developer.mozilla.org/zh-CN/docs/Learn/CSS/CSS_layout/Responsive_Design#%E8%A7%86%E5%8F%A3%E5%85%83%E6%A0%87%E7%AD%BE target=_blank rel=noopener>响应式设计 - 学习 Web 开发 | MDN</a></p></li><li><p><a class=link href=https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/sort target=_blank rel=noopener>Array.prototype.sort() - JavaScript | MDN</a></p></li><li><p><a class=link href="https://lucasfcosta.com/2017/02/17/JavaScript-Errors-and-Stack-Traces.html?utm_source=javascriptweekly&utm_medium=email" target=_blank rel=noopener>JavaScript Errors and Stack Traces in Depth</a></p></li><li><p><a class=link href=https://github.com/ascoders/weekly/blob/master/%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/6.%E7%B2%BE%E8%AF%BB%E3%80%8AJavaScript%20%E9%94%99%E8%AF%AF%E5%A0%86%E6%A0%88%E5%A4%84%E7%90%86%E3%80%8B.md target=_blank rel=noopener>weekly/6.精读《JavaScript 错误堆栈处理》.md at master · ascoders/weekly</a></p></li><li><p><a class=link href=https://sentry.io/features/stacktrace/ target=_blank rel=noopener>Stack Trace Enhancements and Filters | Sentry</a></p></li><li><p><a class=link href=https://www.joyent.com/node-js/production/design/errors target=_blank rel=noopener>Error Handling | Joyent</a></p></li></ul></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>相关文章</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/p/%E6%AF%8E%E6%97%A5%E3%81%AE%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89-359/><div class=article-details><h2 class=article-title>毎日のフロントエンド 359</h2></div></a></article><article><a href=/p/%E6%AF%8E%E6%97%A5%E3%81%AE%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89-358/><div class=article-details><h2 class=article-title>毎日のフロントエンド 358</h2></div></a></article><article><a href=/p/%E6%AF%8E%E6%97%A5%E3%81%AE%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89-357/><div class=article-details><h2 class=article-title>毎日のフロントエンド 357</h2></div></a></article><article><a href=/p/%E6%AF%8E%E6%97%A5%E3%81%AE%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89-352~356/><div class=article-details><h2 class=article-title>毎日のフロントエンド 352~356</h2></div></a></article><article><a href=/p/%E6%AF%8E%E6%97%A5%E3%81%AE%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89-351/><div class=article-details><h2 class=article-title>毎日のフロントエンド 351</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2021 -
2022 技術の手帳</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#tips>Tips</a><ol><li><a href=#移动端禁止用户手动缩放页面>移动端禁止用户手动缩放页面</a></li><li><a href=#arrayprototypesort><code>Array.prototype.sort()</code></a></li><li><a href=#js-错误堆栈处理>JS 错误堆栈处理</a><ol><li><a href=#stack><strong>Stack</strong></a></li><li><a href=#error-对象><strong>Error 对象</strong></a></li><li><a href=#如何使用堆栈追踪>如何使用堆栈追踪</a></li><li><a href=#抛-error-对象的正确方法>抛 Error 对象的正确方法</a></li><li><a href=#异步promise环境下错误处理方式>异步（Promise）环境下错误处理方式</a></li><li><a href=#监控客户端-error-报错>监控客户端 Error 报错</a></li></ol></li></ol></li><li><a href=#reference>Reference</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>